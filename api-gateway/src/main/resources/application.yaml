spring:
  application:
    name: "api-gateway"
  cloud:
    gateway:
      server:
        webflux:
          routes:
            - id: auth-service-route
              uri: http://ckw-auth-service:8080
              predicates:
                - name: Path
                  args:
                    patterns:
                      - /auth/login
                      - /auth/register
                      - /auth/verify
                      - /auth/logout
              filters:
                - name: StripPrefix
                  args:
                    part: 1
            - id: auth-docs-route
              uri: http://ckw-auth-service:8080
              predicates:
                - name: Path
                  args:
                    patterns:
                      - /api-docs/auth
              filters:
                - name: RewritePath
                  args:
                    regexp: /api-docs/auth
                    replacement: /v3/api-docs
            - id: user-service-public-routes
              uri: http://ckw-user-service:8080
              predicates:
                - name: Path
                  args:
                    patterns:
                      - /user
                      - /user/verify-email
                - name: Method
                  args:
                    methods:
                    - POST
              filters:
                - name: StripPrefix
                  args:
                    part: 1
            - id: user-service-private-routes
              uri: http://ckw-user-service:8080
              predicates:
                - name: Path
                  args:
                    patterns:
                      - /user/**
              filters:
                - name: StripPrefix
                  args:
                    part: 1
                - name: JwtValidation
            - id: user-docs-route
              uri: http://ckw-user-service:8080
              predicates:
                - name: Path
                  args:
                    patterns:
                      - /api-docs/user
              filters:
                - name: RewritePath
                  args:
                    regexp: /api-docs/user
                    replacement: /v3/api-docs
            - id: workspace-service-route
              uri: http://ckw-workspace-service:8080
              predicates:
                - name: Path
                  args:
                    patterns:
                      - /workspaces/**
              filters:
                - name: StripPrefix
                  args:
                    part: 1
                - name: JwtValidation
            - id: workspace-docs-route
              uri: http://ckw-workspace-service:8080
              predicates:
                - name: Path
                  args:
                    patterns:
                      - /api-docs/workspace
              filters:
                - name: RewritePath
                  args:
                    regexp: /api-docs/workspace
                    replacement: /v3/api-docs
            - id: page-service-route
              uri: http://ckw-page-service:8080
              predicates:
                - name: Path
                  args:
                    patterns:
                      - /workspace/{workspace_id}/documents/**
              filters:
                - name: JwtValidation
                - name: PageAccessValidation
                - name: StripPrefix
                  args:
                    part: 1
            - id: page-docs-route
              uri: http://ckw-page-service:8080
              predicates:
                - name: Path
                  args:
                    patterns:
                      - /api-docs/page
              filters:
                - name: RewritePath
                  args:
                    regexp: /api-docs/page
                    replacement: /v3/api-docs
            - id: collaboration-service-route
              uri: ws://ckw-collaboration-service:8080
              predicates:
                - name: Path
                  args:
                    patterns:
                      - /collaboration/**
              filters:
                - name: StripPrefix
                  args:
                    part: 1
                - name: JwtValidation

          globalcors:
            cors-configurations:
              "[/**]":
                          allowedOrigins: "${API_GATEWAY_ALLOWED_ORIGINS}"
                          allowedMethods:
                            - GET
                            - POST
                            - PUT
                            - DELETE
                            - OPTIONS
                            - PATCH
                          allowedHeaders: "*"
                          allowCredentials: true
          httpclient:
            websocket:
              max-frame-payload-length: 65536
server:
  port: 8080
logging:
  level:
    root: info
